{"version":3,"sources":["webpack:///webpack/bootstrap 863cf369d887aa4449b7","webpack:///external \"path\"","webpack:///./src/sculpt/src/lib/types.ts","webpack:///./src/sculpt/src/lib/validate.ts","webpack:///./src/utils/log.ts","webpack:///external \"lodash\"","webpack:///./src/sculpt/src/cmd/main.ts","webpack:///./src/sculpt/src/cmd/helpers.ts","webpack:///./src/sculpt/src/lib/defs/helpers.ts","webpack:///./src/sculpt/src/lib/defs/index.ts","webpack:///./src/sculpt/src/lib/generate.ts","webpack:///./src/sculpt/src/lib/index.ts","webpack:///./src/sculpt/src/cmd","webpack:///external \"es6-promisify\"","webpack:///external \"fs\"","webpack:///external \"jsonschema\"","webpack:///external \"minimist\"","webpack:///external \"mkdirp\"","webpack:///external \"prettier\"","webpack:///external \"strip-json-comments\""],"names":[],"mappings":"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","file":"sculpt.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 863cf369d887aa4449b7","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 0\n// module chunks = 0","import {AppDef} from './defs/types';\n\nexport interface GenCtx {\n  defPath: string;\n  def: AppDef;\n  prettierCfg: object;\n  outputDir: string;\n  stack: string;\n}\n\nexport interface GennedFileData {\n  path: string;\n  contents: string;\n  writerName: string;\n}\n\nexport interface WriterResults {\n  files: GennedFileData[];\n}\n\nexport const getDefaultResultsData = (): WriterResults => ({\n  files: [],\n});\n\n// writers are reducers, pure functions that return results after applying some action context\nexport interface Writer {\n  (results: WriterResults, ctx: GenCtx): WriterResults;\n  name: string; // writers are named functions so we get some free meta data\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/sculpt/src/lib/types.ts","import {last} from 'lodash';\n\nimport {Writer, WriterResults} from './types';\n\nexport const validateWriters = (writers: Writer[]): void => {\n  for (const w of writers) {\n    if (!w.name) {\n      throw new Error(\n        `Expected writer(${w}) to have a name prop - try exporting it as a named function`,\n      );\n    }\n  }\n};\n\nexport const validateResults = (results: WriterResults): void => {\n  for (const f of results.files) {\n    if ((last(f.path.split('/')) || '').indexOf('.gen.') === -1) {\n      throw new Error(\n        `Expected file path ${f.path} from ${f.writerName} to have \".gen.\"`,\n      );\n    }\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/sculpt/src/lib/validate.ts","// Simple logger that should work in any env (not preferred for any of them, though)\nexport const logger = (tag: string) => (...args: any[]): void => {\n  if (process.env.NODE_ENV === 'test') return;\n  args.unshift(`[${tag}]`);\n  console.log.apply(console, args);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/log.ts","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 4\n// module chunks = 0","import * as fp from 'path';\nimport * as jsonschema from 'jsonschema';\nimport * as minimist from 'minimist';\nimport * as prettier from 'prettier';\n\nimport {GenCtx, generate} from '../lib';\nimport {loadCommentedJson, log, saveFile} from './helpers';\n\nimport {Writer} from '../lib/types';\n\nfunction printUsage():void {\n  // TODO read from package.json\n  const version = '0.0.0';\n  const usage = `\nsculpt ${version} - next generation generation\nusage: sculpt [options] dir\n\noptions:\n  ?, help         Shows this screen\n  output-dir      Output directory\n  stack           Name of stack to use\n`;\n\n  console.log(usage);\n}\n\n/**\n * Parses CLI args.\n *\n * More info: https://github.com/substack/minimist\n */\nfunction parseArgs(): minimist.ParsedArgs {\n  const defaults = {\n    stack: '$webdev-genstack',\n    defFile: 'app.def.json'\n  };\n  const optionAliases = {\n    defFile: ['f', 'def-file'],\n    verbose: ['v'],\n  };\n  const treatAsBools = ['help', 'verbose'];\n\n  const argv = minimist(process.argv.slice(2), {\n    alias: optionAliases,\n    boolean: treatAsBools,\n    default: defaults,\n  });\n\n  if (argv.help) {\n    printUsage();\n    process.exit(0);\n  }\n\n  // the sole argument is the directory containing app schema\n  const dir = argv._[0] ? argv._[0] : process.env.cwd();\n  argv.workingDir = fp.resolve(dir);\n  return argv;\n}\n\nconst argv = parseArgs();\n\nasync function buildContext(): Promise<GenCtx> {\n  // TODO config/env\n  const appDefPath = fp.join(argv.workingDir, argv.defFile);\n\n  // TODO not sure if this should be part of GenCtx and this will break\n  // since it assumes sculpt is running at dbslate project root\n  const prettierCfgPath = 'config/prettier.json';\n\n  const prettierCfg = await loadCommentedJson(prettierCfgPath);\n\n  // Load the app definition and generate some code\n  const ctx = {\n    defPath: appDefPath,\n    def: await loadCommentedJson(appDefPath),\n    prettierCfg,\n    outputDir: fp.join(argv.workingDir, '_sculpted'),\n    stack: argv.stack,\n  };\n\n  validate(ctx);\n  return ctx;\n}\n\nfunction printInfo(ctx: GenCtx): void {\n  log('🗲 gen');\n  log('app source', ctx.defPath);\n  log('__dirname', __dirname);\n  log('__filename', __filename, fp.join(__dirname, ctx.defPath));\n}\n\nasync function validate(ctx: GenCtx): Promise<void> {\n  // This validation step is not very useful at the moment,\n  // but it can be expanded to better validate the definition file\n  // by editing the `baseSchema` JSON file directly.\n  const baseSchemaPath = fp.resolve(__dirname, '../lib/defs/jsonschema-meta.json');\n  const baseSchema = await loadCommentedJson(baseSchemaPath);\n  const validatorResult = jsonschema.validate(ctx.def, baseSchema);\n  if (validatorResult.errors.length) {\n    throw new Error(`Validator error: ${validatorResult.errors[0]}`);\n  }\n}\n\n// The list of writers determines what gets written to the results data\nasync function getWritersList(ctx: GenCtx): Promise<Writer[]> {\n  const {writers} = await import(ctx.stack);\n  return writers;\n}\n\nasync function main(): Promise<void> {\n  const ctx = await buildContext();\n  printInfo(ctx);\n\n  const writers = await getWritersList(ctx);\n\n  // `gen.generate` is a pure function - is does not perform any io actions or mutate anything external\n  const resultsData = generate(ctx, writers);\n\n  // write the results to the file system, to fit expected programmer workflow\n  for (const file of resultsData.files) {\n    let finalContents = file.contents;\n    try {\n      finalContents = prettier.format(file.contents, ctx.prettierCfg);\n    } catch (err) {\n      log(`failed to prettify, saving unprettified version: ${err}`);\n    }\n    saveFile(file.path, finalContents);\n  }\n\n  // all done\n  log('✔ gen');\n}\n\nmain().catch(err => {\n  log('err', err);\n  throw err;\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/sculpt/src/cmd/main.ts","import * as fp from 'path';\nimport * as fs from 'fs';\nimport * as mkdirp from 'mkdirp';\nimport * as promisify from 'es6-promisify';\nimport * as stripJsonComments from 'strip-json-comments';\n\nimport {logger} from '$utils/log';\n\n// TODO this is expected to run only in node.. do something to enforce that or something\n\n// TODO doesn't get the correct type, had to manually add\nconst readFile: (path: string, options: {encoding: 'utf8'}) => Promise<string> = promisify(\n  fs.readFile\n);\n\nexport const loadCommentedJson = async (path: string): Promise<any> => {\n  const contents = await readFile(path, {encoding: 'utf8'});\n  const stripped = stripJsonComments(contents);\n  const parsed = JSON.parse(stripped);\n  return parsed;\n};\n\nexport function saveFile(filename: string, contents: string): void {\n  log('saving', filename);\n  // ensure dir exists\n  mkdirp.sync(fp.dirname(filename));\n  fs.writeFileSync(filename, contents, {\n    encoding: 'utf8',\n  });\n  log('saved~', filename);\n}\n\nexport const log = logger('task:gen');\n\n\n\n// WEBPACK FOOTER //\n// ./src/sculpt/src/cmd/helpers.ts","import {last} from 'lodash';\n\nimport {AppDef, SchemaDefinition} from './types';\n\n// TODO is hacky, should probably follow relative path on def tree.\nexport const extractRefTypeTitle = ($ref: string): string =>\n  last($ref.split('/')) || '';\n\nexport const lookupDef = (d: AppDef, $ref: string): SchemaDefinition =>\n  d.definitions[extractRefTypeTitle($ref)];\n\nexport const getActions = (d: AppDef): SchemaDefinition[] =>\n  (d.definitions.Action.oneOf as any).map((a: any) =>\n    lookupDef(d, a.$ref || ''),\n  );\n\n// TODO check recursively\n// export const inheritsFrom = ($ref: string) => (\n//   d: SchemaDefinition,\n// ): boolean => !!d.allOf && d.allOf.some(a => a.$ref === $ref);\n\n\n\n// WEBPACK FOOTER //\n// ./src/sculpt/src/lib/defs/helpers.ts","export * from './helpers';\nexport * from './types';\n\n\n\n// WEBPACK FOOTER //\n// ./src/sculpt/src/lib/defs/index.ts","import {GenCtx, Writer, WriterResults, getDefaultResultsData} from './types';\nimport {validateResults, validateWriters} from './validate';\n\nimport {logger} from '$utils/log';\n\nconst log = logger('gen');\n\n// TODO consider making this async, or at least allowing writers to use promises\n// Writers are reducers, pure functions that return state as a function of,\n// in this case, `Writers`. They can return whatever results at their stage of the pipeline.\nexport const generate = (ctx: GenCtx, writers: Writer[]): WriterResults => {\n  validateWriters(writers);\n  return writers.reduce((results, writer) => {\n    log('writing', undefined, writer.name); // TODO the undefined smells\n    const writerResults = writer(results, ctx);\n    validateResults(writerResults);\n    // TODO could diff results\n    log('wrote~~', undefined, writer.name); // TODO the undefined smells\n    return writerResults;\n  }, getDefaultResultsData());\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/sculpt/src/lib/generate.ts","export * from './defs';\nexport * from './generate';\nexport * from './types';\nexport * from './validate';\n\nimport * as fp from 'path';\n\n//// TODO should be discovered\n\n// user's working project dir\nexport const userProjectDir = () => fp.resolve(__dirname, '../_userProject');\n\n// TODO this should be package name not path\n// user's chosen gen stack\n//export const userStack = () => '$webdev-genstack';\n//export const userStack = () => '$webdev-genstack';\n\n// path to gen package dir which contains/*.def.json\nexport const genPackageDir = () => '../../src/gen';\n\n\n\n// WEBPACK FOOTER //\n// ./src/sculpt/src/lib/index.ts","function webpackEmptyContext(req) {\n\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 11;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/sculpt/src/cmd\n// module id = 11\n// module chunks = 0","module.exports = require(\"es6-promisify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"es6-promisify\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"jsonschema\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonschema\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"minimist\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"minimist\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"mkdirp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mkdirp\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"prettier\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"prettier\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"strip-json-comments\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"strip-json-comments\"\n// module id = 18\n// module chunks = 0"],"sourceRoot":""}